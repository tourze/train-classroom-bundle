services:
  # default configuration for services in *this* file
  _defaults:
    autowire: true      # Automatically injects dependencies in your services.
    autoconfigure: true # Automatically registers your services as commands, event subscribers, etc.
    public: false

  Tourze\TrainClassroomBundle\Command\:
    resource: '../../Command/'
  Tourze\TrainClassroomBundle\Command\DataLoader\:
    resource: '../../Command/DataLoader/'
    public: true
  Tourze\TrainClassroomBundle\Controller\:
    resource: '../../Controller/'
  Tourze\TrainClassroomBundle\Repository\:
    resource: '../../Repository/'
  Tourze\TrainClassroomBundle\Service\:
    resource: '../../Service/'
    public: true
  Tourze\TrainClassroomBundle\Procedure\:
    resource: '../../Procedure/'
    public: true

  # 接口到实现类的绑定
  Tourze\TrainClassroomBundle\Service\RegistrationServiceInterface:
    alias: Tourze\TrainClassroomBundle\Service\RegistrationService
    public: true
  Tourze\TrainClassroomBundle\Service\DeviceServiceInterface:
    alias: Tourze\TrainClassroomBundle\Service\DeviceService
    public: true
  Tourze\TrainClassroomBundle\Service\AttendanceServiceInterface:
    alias: Tourze\TrainClassroomBundle\Service\AttendanceService
    public: true
  Tourze\TrainClassroomBundle\Service\ClassroomServiceInterface:
    alias: Tourze\TrainClassroomBundle\Service\ClassroomService
    public: true
  Tourze\TrainClassroomBundle\Service\ScheduleServiceInterface:
    alias: Tourze\TrainClassroomBundle\Service\ScheduleService
    public: true

  # AttendanceVerifier实现类标记
  Tourze\TrainClassroomBundle\Service\AttendanceVerifier\ManualVerifier:
    tags:
      - { name: 'train_classroom.attendance_verifier' }
  Tourze\TrainClassroomBundle\Service\AttendanceVerifier\CardVerifier:
    tags:
      - { name: 'train_classroom.attendance_verifier' }
  Tourze\TrainClassroomBundle\Service\AttendanceVerifier\FaceRecognitionVerifier:
    tags:
      - { name: 'train_classroom.attendance_verifier' }
  Tourze\TrainClassroomBundle\Service\AttendanceVerifier\FingerprintVerifier:
    tags:
      - { name: 'train_classroom.attendance_verifier' }
  Tourze\TrainClassroomBundle\Service\AttendanceVerifier\QrCodeVerifier:
    tags:
      - { name: 'train_classroom.attendance_verifier' }

  # DeviceTester实现类标记
  Tourze\TrainClassroomBundle\Service\DeviceTester\GenericDeviceTester:
    tags:
      - { name: 'train_classroom.device_tester' }

  # 服务依赖配置
  Tourze\TrainClassroomBundle\Service\AttendanceDeviceManager:
    arguments:
      $verifiers: !tagged_iterator { tag: 'train_classroom.attendance_verifier' }

  Tourze\TrainClassroomBundle\Service\DeviceConfigManager:
    arguments:
      $testers: !tagged_iterator { tag: 'train_classroom.device_tester' }

  # 显式配置RegistrationService确保参数正确
  Tourze\TrainClassroomBundle\Service\RegistrationService:
    arguments:
      $registrationRepository: '@Tourze\TrainClassroomBundle\Repository\RegistrationRepository'
      $entityManager: '@doctrine.orm.entity_manager'
      $logger: '@logger'